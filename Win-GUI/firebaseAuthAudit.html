<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>CryptoAlgo</title>
        <!-- Core CSS -->
        <link rel="stylesheet" href="assets/css/main.css" />

        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.15.4/firebase-app.js"></script>

        <script src="assets/js/jquery.min.js" sync></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
                https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="https://www.gstatic.com/firebasejs/ui/4.5.1/firebase-ui-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.15.4/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.15.4/firebase-storage.js"></script>

        <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.5.1/firebase-ui-auth.css" />
        <link type="text/css" rel="stylesheet" href="assets/css/authPage.css" />
        <link type="text/css" rel="stylesheet" href="assets/css/materialProgressBar.css" />

        <script>
            // Your web app's Firebase configuration
            var firebaseConfig = {
                apiKey: "AIzaSyDu3GBqQg6o9Mp7Ay6KkTKRnqogZWmhU6c",
                authDomain: "cryptoalgogui.firebaseapp.com",
                databaseURL: "https://cryptoalgogui.firebaseio.com",
                projectId: "cryptoalgogui",
                storageBucket: "cryptoalgogui.appspot.com",
                messagingSenderId: "104602369567",
                appId: "1:104602369567:web:bcfdad88debbb2b8cddf2a",
                measurementId: "G-YT1W6G83B3"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);

            // Initialize the FirebaseUI Widget using Firebase.
            var ui = new firebaseui.auth.AuthUI(firebase.auth());

            const uiConfig = {
                callbacks: {
                    signInSuccessWithAuthResult: function(authResult, redirectUrl) {
                        // User successfully signed in.
                        // Return type determines whether we continue the redirect automatically
                        // or whether we leave that to developer to handle.
                        return false;
                    },
                    uiShown: function () {
                        document.getElementById('loader').style.display = 'none';
                        document.getElementById('firebaseui-auth-container').style.display = 'block';
                    }
                },
                credentialHelper: firebaseui.auth.CredentialHelper.NONE,  // Stop being redirected to accountchooser.com
                signInOptions: [
                    // Leave the lines as is for the providers you want to offer your users.
                    {
                        provider: firebase.auth.GoogleAuthProvider.PROVIDER_ID,
                        customParameters: {
                            // Forces account selection even when one account
                            // is available.
                            prompt: 'select_account'
                        }
                    },
                    firebase.auth.GithubAuthProvider.PROVIDER_ID,
                    firebase.auth.EmailAuthProvider.PROVIDER_ID,
                    firebase.auth.FacebookAuthProvider.PROVIDER_ID,
                    {
                        provider: firebase.auth.PhoneAuthProvider.PROVIDER_ID,
                        recaptchaParameters: {
                            type: 'image', // 'audio'
                            size: 'normal', // 'invisible' or 'compact'
                            badge: 'bottomleft' //' bottomright' or 'inline' applies to invisible.
                        },
                        defaultCountry: 'SG',
                        defaultNationalNumber: '96543217' // Prefilled phone no
				    }
                ],
                // tosUrl and privacyPolicyUrl accept either url string or a callback
                // function.
                // Terms of service url/callback.
                tosUrl: 'credits.html',
                // Privacy policy url/callback.
                privacyPolicyUrl: '<your-privacy-policy-url>'
            };
        </script>
        <script src="assets/js/authHelper.js" defer></script>
    </head>
    <body ondragstart="return false;">
        <section id="one" class="wrapper style2 accountMgmt">
            <div style="text-align: center" id="contentArea">
                <h2 id="headText"> </h2>

                <div id="profileSpace" style="display: none">
                    <!-- User elements (Profile pic, name and email) -->
                    <img id="usrProfilePic" onerror="this.src='images/pfpPlaceholder.png'" src="" alt="Profile Image" height="100px" width="100px"></img>
                    <h2 id="usrName" style="text-transform: none; font-weight: bold;">Hello, unknown user</h2>
                    <p id="usrEmail">Email</p>

                    <!-- Email verification (Only becomes visible if needed) -->
                    <ul class="actions" id="verifyEmail" style="margin: 0 0 10px 0; display: none;">
                        <li><a onclick="verifyEmail()" title="Email Verification" class="button alt">Verify Email</a></li>
                    </ul>

                    <!-- Action buttons -->
                    <ul class="actions" style="margin: 10px 0 10px 0">
                        <li><a onclick="signOutUser()" title="Sign Out" class="button alt"><i class="material-icons">power_settings_new</i></a></li>
                        <li><a onclick="usrSettingsCloseOpen()" title="Profile Settings" class="button alt"><i class="material-icons" id="settingsBtn">settings</i></a></li>
                    </ul>

                    <!-- User Settings -->
                    <div id="profileSettings" class="auth" style="display: none;">
                        <h2 style="margin: 0px">Settings</h2>

                        <!-- Change name -->
                        <button class="collapsible"> Update Name </button>
                        <div class="content">
                            <label class="authLabels" for="displayName">New display name:</label>
                            <input class="authInput" type="text" id="displayName" name="displayName">

                            <ul class="actions" style="margin: 10px 0 10px 0">
                                <li><a onclick="updateProfile()" title="Save Settings" class="button alt"><i class="material-icons">done</i></a></li>
                            </ul>
                        </div>

                        <!-- Update Profile Picture -->
                        <button class="collapsible"> Update Profile Picture </button>
                        <div class="content">
                            <input accept="image/*" id="profilePicSelector" style="display: none" type="file">
                            <ul class="actions" style="margin: 10px 0 10px 0">
                                <li><a onclick="$('#profilePicSelector').click();" title="Upload image" class="button alt"><i class="material-icons">upload</i></a></li>
                            </ul>
                            <p style="margin: 5px;">Upload an image <br />
                            (File size: <= 2MB)</p>

                            <!-- Upload progress bar -->
                            <div class="progressBarOuter" id="progressBarOuter">
                                <div id="progressBar" class="progressBar"></div>
                            </div>
                        </div>

                        <!-- Change Password Portion -->
                        <button class="collapsible"> Change Password </button>
                        <div class="content" id="pwdChange">
                            <label class="authLabels" for="oldPwd">Old password: </label>
                            <input class="authInput" type="password" id="oldPwd" name="oldPwd">
                            <label class="authLabels" for="changePwd">New password: </label>
                            <input class="authInput" type="password" id="changePwd" name="changePwd">
                            <label class="authLabels" for="confirmChangePwd">Confirm password: </label>
                            <input class="authInput" type="password" id="confirmChangePwd" name="confirmChangePwd">

                            <ul class="actions" style="margin: 10px 0 10px 0">
                                <li><a onclick="changeUserPassword()" title="Save Settings" class="button alt"><i class="material-icons">done</i></a></li>
                            </ul>
                        </div>

                        <!-- Update Email Portion -->
                        <button class="collapsible"> Update Email </button>
                        <div class="content">
                            <label class="authLabels" for="emailChgPwd">Password: </label>
                            <input class="authInput" type="password" id="emailChgPwd" name="emailChgPwd">
                            <label class="authLabels" for="changeEmail">New email</label>
                            <input class="authInput" type="email" id="changeEmail" placeholder="New email address" name="changeEmail">

                            <ul class="actions" style="margin: 10px 0 10px 0">
                                <li><a onclick="updateEmail()" title="Save Settings" class="button alt"><i class="material-icons">done</i></a></li>
                            </ul>
                        </div>

                        <!-- Delete Account -->
                        <button class="collapsible bottomLast">Account Deletion</button>
                        <div class="content">
                            <label class="authLabels" for="acctDeletePwd">Password: </label>
                            <input class="authInput" type="password" id="acctDeletePwd" name="acctDeletePwd">
                            <p style="color: red; margin: 10px 0 0 0">By clicking "Delete Account", I understand that my account will be permanently deleted. 
                            THIS ACTION CANNOT BE UNDONE! Any data stored in our database will be deleted and CANNOT be recovered.</p>
                            <ul class="actions" style="margin: 8px">
                                <li><a style="box-shadow: inset 0 0 0 2px red" onclick="deleteUser()" title="DELETE ACCOUNT" class="button alt">DELETE ACCOUNT</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="loginArea" style="display: none">
                    <div class="auth" style="display: none" id="firebaseui-auth-container"></div>

                    <!-- The CSS code is in another file. This loader will be hidden by the firebase auth when loading completes -->
                    <div class="progress" id="loader">
                        <div class="indeterminate"></div>
                    </div>
                    <p style="margin: 5px 0 0 0; color: white; font-weight: 900;"> Phone login is less secure than other methods and still in beta. </p>

                    <div class="auth" style="margin-top: 20px;">
                    <button class="collapsible newAcct" style="border-width: 0px; border-radius: 7px;">Create Account</button>
                        <div class="content" id="newAccount">
                            <div>
                                <label class="authLabels" for="newUsername">Email:</label>
                                <input class="authInput" type="text" id="newUsername" name="newUsername">
                            </div>
                            <div>
                                <label class="authLabels" for="newPassword">New Password:</label>
                                <input class="authInput" type="password" placeholder="7-64 characters starting with a letter" id="newPassword" name="NewPassword">
                            </div>
                            <div>
                                <label class="authLabels" for="confirmPassword">Confirm Password:</label>
                                <input class="authInput" type="password" id="confirmPassword" name="confirmPassword">
                            </div>
                            <a onclick="createNewAccount()" class="button alt submitBtn" title="Create Account"><i class="material-icons">add_circle</i></a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- The Modal (Warning box) -->
            <div id="infoArea" class="modal">
                <!-- Modal content -->
                <div id="modal-content" class="modal-content">
                    <span class="close" onclick="closeModal()"><i style="margin: 0px;" class="material-icons">close</i></span>
                    <h2 class="modelText" id="infoText"></p>
                </div>
            </div>
        </section>

            <!-- Footer -->
        <footer id="footer" class="wrapper">
            <div class="inner">
                <div class="copyright">
                    <p>This project is maintained by <a href="mailto:support@cryptoalgo.cf">@CryptoAlgo</a>.</p>
                </div>
            </div>
        </footer>

        <script>
            var coll = document.getElementsByClassName("collapsible");
            var i;

            for (i = 0; i < coll.length; i++) {
                coll[i].addEventListener("click", function() {
                    this.classList.toggle("active");
                    var content = this.nextElementSibling;
                    if (content.style.maxHeight){
                        content.style.maxHeight = null;
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                    } 
                });
            }
        </script>
    </body>
</html>